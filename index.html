<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stream Timer PRO</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

<style>
body{
    margin:0;
    background:transparent;
    font-family:Arial, sans-serif;
    color:white;
}

.timer-box{
    position:absolute;
    left:40px;
    top:40px;
    font-size:60px;
    font-weight:bold;
    background:rgba(0,0,0,0.75);
    padding:25px;
    border-radius:20px;
    text-align:center;
    box-shadow:0 0 30px red;
    transition:0.3s;
}

.red{
    color:red;
    text-shadow:0 0 20px red;
}

.donate-box{
    position:absolute;
    right:40px;
    top:40px;
    width:280px;
    background:rgba(0,0,0,0.75);
    padding:20px;
    border-radius:20px;
    text-align:center;
    box-shadow:0 0 25px #00ff99;
}

.price-box{
    margin-top:15px;
    color:#00ff99;
    font-weight:bold;
}
</style>
</head>
<body>

<div class="timer-box" id="timer">
0–¥<br>00—á<br>00–º<br>00—Å
</div>

<div class="donate-box">
    <div style="font-size:22px;">üíé –î–æ–Ω–∞—Ç—ã</div>
    <div id="lastDonate" style="margin-top:15px;">
        –ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–Ω–∞—Ç:<br>‚Äî –Ω–µ—Ç ‚Äî
    </div>
    <div class="price-box">
        5‚ÇΩ = 1 –º–∏–Ω—É—Ç–∞
    </div>
</div>

<script>

let totalSeconds = 0;
let pricePerMinute = 5;

/* ===== –¢–ê–ô–ú–ï–† ===== */

function updateTimer(){
    if(totalSeconds > 0){
        totalSeconds--;
    }

    let d = Math.floor(totalSeconds / 86400);
    let h = Math.floor((totalSeconds % 86400)/3600);
    let m = Math.floor((totalSeconds % 3600)/60);
    let s = totalSeconds % 60;

    let timerEl = document.getElementById("timer");

    timerEl.innerHTML =
        d + "–¥<br>" +
        String(h).padStart(2,'0') + "—á<br>" +
        String(m).padStart(2,'0') + "–º<br>" +
        String(s).padStart(2,'0') + "—Å";

    if(totalSeconds <= 60){
        timerEl.classList.add("red");
    } else {
        timerEl.classList.remove("red");
    }
}

setInterval(updateTimer,1000);

/* ===== –î–û–ë–ê–í–õ–ï–ù–ò–ï –í–†–ï–ú–ï–ù–ò ===== */

function processDonation(data){

    if (!data) return;

    console.log("üî• –ü–û–õ–£–ß–ï–ù –î–û–ù–ê–¢:", data);

    if (Number(data.alert_type) !== 1) return;

    let nick = data.username || "–ê–Ω–æ–Ω–∏–º";
    let amount = parseFloat(data.amount);

    if (!amount) return;

    let minutes = Math.floor(amount / pricePerMinute);

    if (minutes <= 0) return;

    totalSeconds += minutes * 60;

    document.getElementById("lastDonate").innerHTML =
        "–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–Ω–∞—Ç:<br>" +
        "<b style='color:#00ff99'>" + nick + "</b><br>" +
        "+ " + minutes + " –º–∏–Ω";

    let box = document.querySelector(".timer-box");
    box.style.transform = "scale(1.1)";
    setTimeout(()=>{ box.style.transform="scale(1)"; },300);
}

/* ===== SOCKET ===== */

var socket = io("https://socket.donationalerts.ru", {
    transports:["polling"]
});

socket.on("connect", function(){
    console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ DonationAlerts");

    socket.emit("add-user", {
        token: "Zvk2S9bNr4AujcccGrTs",
        type: "alert_widget"
    });
});

/* –°–õ–£–®–ê–ï–ú –í–°–ï –í–ê–†–ò–ê–ù–¢–´ */

socket.on("alert", processDonation);
socket.on("donation", processDonation);
socket.on("new-donation", processDonation);

socket.on("connect_error", function(e){
    console.log("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:", e);
});

</script>

</body>
</html>
