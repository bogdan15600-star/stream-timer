<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Stream Timer</title>

<!-- Socket.IO v2 (–í–ê–ñ–ù–û!) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

<style>
body{
    margin:0;
    background:transparent;
    font-family:Arial, sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    flex-direction:column;
}

/* –¢–ê–ô–ú–ï–† */
.timer-box{
    background:rgba(0,0,0,0.75);
    padding:25px 35px;
    border-radius:20px;
    text-align:center;
    color:#00ff99;
    box-shadow:0 0 30px rgba(0,255,150,0.6);
}

.time{
    font-size:50px;
    font-weight:bold;
    line-height:1.2;
    transition:0.3s;
}

.red{
    color:#ff2b2b !important;
    text-shadow:0 0 15px red;
}

.shake{
    animation:shake 0.5s;
}

@keyframes shake{
    0%{transform:translateX(0);}
    25%{transform:translateX(-5px);}
    50%{transform:translateX(5px);}
    75%{transform:translateX(-5px);}
    100%{transform:translateX(0);}
}

/* –û–ö–ù–û –î–û–ù–ê–¢–û–í */
.donate-box{
    margin-top:20px;
    background:rgba(0,0,0,0.8);
    padding:15px 25px;
    border-radius:15px;
    text-align:center;
    color:white;
    width:250px;
    box-shadow:0 0 20px rgba(255,255,255,0.2);
}

.last-donate{
    font-size:18px;
    margin-bottom:10px;
}

.price{
    font-size:14px;
    opacity:0.8;
}

.price-anim{
    animation:priceFlash 1s;
}

@keyframes priceFlash{
    0%{color:white;}
    50%{color:orange;}
    100%{color:white;}
}

.admin-panel{
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:#200000;
    padding:15px;
    color:white;
    text-align:center;
}
.admin-panel button{
    margin:5px;
    padding:8px 15px;
    background:#a00000;
    color:white;
    border:none;
    border-radius:8px;
    cursor:pointer;
}
.admin-panel button:hover{
    background:#ff0000;
}
</style>
</head>

<body>

<div class="timer-box" id="timerBox">
    <div class="time" id="timer">0–¥<br>00—á<br>00–º<br>00—Å</div>
</div>

<div class="donate-box">
    <div class="last-donate" id="lastDonate">–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–Ω–∞—Ç: ‚Äî</div>
    <div class="price" id="priceDisplay">5‚ÇΩ = 1 –º–∏–Ω—É—Ç–∞</div>
</div>

<div class="admin-panel">
    –¶–µ–Ω–∞:
    <button onclick="changePrice(5)">+5‚ÇΩ</button>
    <button onclick="changePrice(-5)">-5‚ÇΩ</button>
    –í—Ä–µ–º—è:
    <button onclick="addManualTime(60)">+1 –º–∏–Ω</button>
    <button onclick="addManualTime(3600)">+1 —á–∞—Å</button>
    <button onclick="addManualTime(86400)">+1 –¥–µ–Ω—å</button>
</div>

<script>
let totalSeconds = 0;
let pricePerMinute = 5;

/* ===== –¢–ê–ô–ú–ï–† ===== */

function updateTimer(){
    if(totalSeconds > 0){
        totalSeconds--;
    }

    let days = Math.floor(totalSeconds / 86400);
    let hours = Math.floor((totalSeconds % 86400)/3600);
    let minutes = Math.floor((totalSeconds % 3600)/60);
    let seconds = totalSeconds % 60;

    document.getElementById("timer").innerHTML =
        days + "–¥<br>" +
        String(hours).padStart(2,'0') + "—á<br>" +
        String(minutes).padStart(2,'0') + "–º<br>" +
        String(seconds).padStart(2,'0') + "—Å";

    if(totalSeconds <= 60){
        document.getElementById("timer").classList.add("red");
    }else{
        document.getElementById("timer").classList.remove("red");
    }
}

setInterval(updateTimer,1000);

function addTime(seconds, nick, minutesAdded){
    totalSeconds += seconds;

    document.getElementById("timerBox").classList.add("shake");
    setTimeout(()=>document.getElementById("timerBox").classList.remove("shake"),500);

    document.getElementById("lastDonate").innerHTML =
        "–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–Ω–∞—Ç:<br><b style='color:#00ff99'>" +
        nick + "</b> +" + minutesAdded + " –º–∏–Ω";
}

function changePrice(amount){
    pricePerMinute += amount;
    if(pricePerMinute < 1) pricePerMinute = 1;

    let priceDisplay = document.getElementById("priceDisplay");
    priceDisplay.innerHTML = pricePerMinute + "‚ÇΩ = 1 –º–∏–Ω—É—Ç–∞";
    priceDisplay.classList.add("price-anim");
    setTimeout(()=>priceDisplay.classList.remove("price-anim"),1000);
}

function addManualTime(sec){
    totalSeconds += sec;
}

/* ===== SOCKET ===== */

var socket = io.connect("https://socket.donationalerts.ru");

socket.on('connect', function() {
    console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ DonationAlerts");

    socket.emit('add-user', {
        token: "SckIMM0CnAulnI4mlzL74swNoK8utSXhOCyXPJJD",
        type: "alert_widget"
    });
});

// –õ–æ–≤–∏–º –í–°–ï –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
socket.on('alert', handleDonation);
socket.on('donation', handleDonation);
socket.on('message', function(msg){
    console.log("üì® MESSAGE:", msg);
});

function handleDonation(msg){

    console.log("üî• EVENT:", msg);

    if (!msg) return;

    // –ø—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–Ω–∞—Ç
    if (msg.alert_type != 1 && msg.type !== "donation") return;

    var nick = msg.username;
    var amount = parseFloat(msg.amount);

    if (!amount || amount < 1) return;

    var minutesAdded = Math.floor(amount / pricePerMinute);
    if (minutesAdded <= 0) return;

    addTime(minutesAdded * 60, nick, minutesAdded);
}
</script>

</body>
</html>
