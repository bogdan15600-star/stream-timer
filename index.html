<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stream Timer PRO</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>

<style>
body{
    margin:0;
    background:transparent;
    font-family:Arial;
    color:white;
}

.timer-box{
    position:absolute;
    left:40px;
    top:40px;
    font-size:60px;
    font-weight:bold;
    background:rgba(0,0,0,0.7);
    padding:25px;
    border-radius:20px;
    text-align:center;
    box-shadow:0 0 30px red;
    transition:0.3s;
}

.red{
    color:red;
    text-shadow:0 0 20px red;
}

.donate-box{
    position:absolute;
    right:40px;
    top:40px;
    width:260px;
    background:rgba(0,0,0,0.7);
    padding:20px;
    border-radius:20px;
    text-align:center;
    box-shadow:0 0 25px #00ff99;
}

.price-box{
    margin-top:15px;
    color:#00ff99;
}
</style>
</head>
<body>

<div class="timer-box" id="timer">
0–¥<br>00—á<br>00–º<br>00—Å
</div>

<div class="donate-box">
    <div style="font-size:22px;">üíé –î–æ–Ω–∞—Ç—ã</div>
    <div id="lastDonate">–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–Ω–∞—Ç:<br>‚Äî –Ω–µ—Ç ‚Äî</div>
    <div class="price-box" id="priceBox">5‚ÇΩ = 1 –º–∏–Ω—É—Ç–∞</div>
</div>

<script>

let totalSeconds = 0;
let pricePerMinute = 5;

function updateTimer(){
    if(totalSeconds > 0){
        totalSeconds--;
    }

    let d = Math.floor(totalSeconds / 86400);
    let h = Math.floor((totalSeconds % 86400)/3600);
    let m = Math.floor((totalSeconds % 3600)/60);
    let s = totalSeconds % 60;

    let el = document.getElementById("timer");

    el.innerHTML =
        d + "–¥<br>" +
        String(h).padStart(2,'0') + "—á<br>" +
        String(m).padStart(2,'0') + "–º<br>" +
        String(s).padStart(2,'0') + "—Å";

    if(totalSeconds <= 60){
        el.classList.add("red");
    }else{
        el.classList.remove("red");
    }
}

setInterval(updateTimer,1000);

function addTime(seconds, nick, minutes){
    totalSeconds += seconds;

    document.getElementById("lastDonate").innerHTML =
        "–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥–æ–Ω–∞—Ç:<br><b style='color:#00ff99'>" +
        nick + "</b> +" + minutes + " –º–∏–Ω";

    document.querySelector(".timer-box").style.transform="scale(1.1)";
    setTimeout(()=>{
        document.querySelector(".timer-box").style.transform="scale(1)";
    },300);
}

/* ===== WebSocket DonationAlerts ===== */

var socket = io("https://socket.donationalerts.ru:443", {
    transports: ["websocket"]
});

socket.on("connect", function(){
    console.log("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ");

    socket.emit("add-user", {
        token: "Zvk2S9bNr4AujcccGrTs",
        type: "alert_widget"
    });
});

socket.on("connect_error", function(e){
    console.log("‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:", e);
});

socket.on("new-donation", function(msg){
    console.log("üí∞ –î–æ–Ω–∞—Ç:", msg);

    let nick = msg.username;
    let amount = parseFloat(msg.amount);

    let minutes = Math.floor(amount / pricePerMinute);
    if(minutes <= 0) return;

    addTime(minutes * 60, nick, minutes);
});

</script>

</body>
</html>
