const token = localStorage.getItem("donation_token");

if (token) {

    socket = new WebSocket("wss://socket.donationalerts.ru:443");

    // –£–°–ü–ï–®–ù–û–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï
    socket.onopen = () => {
        console.log("‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω");

        socket.send(JSON.stringify({
            type: "subscribe",
            channel: `private-donations.${token}`
        }));
    };

    // –ü–û–õ–£–ß–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–ô
    socket.onmessage = (event) => {
        console.log("üì© –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞:", event.data);

        try {
            const data = JSON.parse(event.data);

            if (data.type === "donation") {
                const amount = data.data.amount;
                console.log("üí∞ –î–æ–Ω–∞—Ç:", amount);
            }

        } catch (e) {
            console.error("‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON:", e);
        }
    };

    // –û–®–ò–ë–ö–ê –°–û–ö–ï–¢–ê
    socket.onerror = (error) => {
        console.error("üö® WebSocket –æ—à–∏–±–∫–∞:", error);
    };

    // –ó–ê–ö–†–´–¢–ò–ï –°–û–ï–î–ò–ù–ï–ù–ò–Ø
    socket.onclose = (event) => {
        console.error("üîå WebSocket –∑–∞–∫—Ä—ã—Ç");
        console.log("–ö–æ–¥:", event.code);
        console.log("–ü—Ä–∏—á–∏–Ω–∞:", event.reason);
    };

} else {
    console.warn("‚ö†Ô∏è –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω. –ù—É–∂–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.");
}
